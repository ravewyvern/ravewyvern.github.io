<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Android Package Search</title>
  <style>
    :root {
      --bg: #1a1b26;
      --fg: #a9b1d6;
      --panel: #24283b;
      --border: #414868;
      --highlight: #292e42;
      --green: #9ece6a;
      --orange: #ff9e64;
      --red: #f7768e;
      --dark-red: #db4b4b;
      --blue: #7aa2f7;
    }
    * { box-sizing: border-box; }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      margin: 0;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--blue);
    }
    .controls {
      display: flex;
      flex-wrap: wrap; 
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    .controls input, .controls select {
      padding: 0.75rem;
      font-size: 1rem;
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--fg);
      border-radius: 8px;
      flex-grow: 1; 
    }
    .package {
      display: flex;
      flex-direction: column; 
      gap: 1rem;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .package:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .package-main { flex-grow: 1; }
    .package-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .package h2 {
      margin: 0;
      font-size: 1.25rem;
      word-break: break-all;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: bold;
      margin-left: 0.5rem;
      white-space: nowrap;
    }
    .badge--Recommended { background: var(--green); color: #1a1b26; }
    .badge--Advanced { background: var(--orange); color: #1a1b26; }
    .badge--Expert { background: var(--red); color: #1a1b26; }
    .badge--Unsafe { background: var(--dark-red); color: #fff; }

    .info { margin: 0.5rem 0; line-height: 1.6; }
    .info strong { color: var(--blue); }
    .cmd-block {
      background: var(--highlight);
      padding: 0.75rem;
      border-radius: 6px;
      margin-top: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: "Fira Code", monospace;
    }
    .cmd-block button {
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: var(--border);
      color: var(--fg);
      margin-left: 1rem;
      transition: background-color 0.2s;
    }
    .cmd-block button:hover { background: #565f89; }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      flex-shrink: 0;
    }
    .action-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      text-decoration: none;
      background: var(--border);
      color: var(--fg);
      transition: background-color 0.2s ease;
    }
    .action-btn:hover { background-color: #565f89; }
    .action-btn svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    /* Fancy Links Section */
    .links-container {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .fancy-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--highlight);
      padding: 4px 8px;
      border-radius: 6px;
      text-decoration: none;
      color: var(--blue);
      font-size: 0.9rem;
    }
    .fancy-link:hover { text-decoration: underline; }
    .fancy-link img {
      width: 16px;
      height: 16px;
      border-radius: 2px;
    }

    #showMoreBtn {
      display: block;
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      background: var(--blue);
      color: var(--bg);
      cursor: pointer;
      margin-top: 1rem;
    }
    #showMoreBtn:hover { opacity: 0.9; }

    @media (min-width: 768px) {
      .controls { flex-wrap: nowrap; }
      .package { flex-direction: row; }
    }
  </style>
</head>
<body>

  <svg width="0" height="0" style="display: none;">
    <symbol id="icon-playstore" viewBox="0 0 512 512"><path d="M498.4 239.2c-3.2-12-16-48-16-48L320 32 48 320l144 144 288.8-176.8c11.2-8.8 13.6-24 4.8-35.2zM256 320L96 144l32-32 128 112 128-112 32 32-160 176z"/></symbol>
    <symbol id="icon-fdroid" viewBox="0 0 24 24"><path d="M18.5 7a4.5 4.5 0 10-9 0 4.5 4.5 0 009 0zm-13 0a4.5 4.5 0 10-9 0 4.5 4.5 0 009 0zM5.5 17a4.5 4.5 0 109 0 4.5 4.5 0 00-9 0z" transform="translate(2 3.5) scale(.9)"/></symbol>
    <symbol id="icon-exodus" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H8l4-5v4h3l-4 5z"/></symbol>
  </svg>

  <h1>Android Package Search</h1>
  <div class="controls">
    <input type="text" id="search" placeholder="Search packages..." />
    <select id="filterList">
      <option value="">All Lists</option>
      <option value="aosp">AOSP</option>
      <option value="carrier">Carrier</option>
      <option value="google">Google</option>
      <option value="misc">Misc</option>
      <option value="oem">OEM</option>
    </select>
    <select id="filterRemoval">
      <option value="">All Removal Levels</option>
      <option value="Recommended">Recommended</option>
      <option value="Advanced">Advanced</option>
      <option value="Expert">Expert</option>
      <option value="Unsafe">Unsafe</option>
    </select>
  </div>
  <div id="results"></div>
  <button id="showMoreBtn" style="display: none;">Show More</button>

  <script>
    const DATA_URL = 'https://raw.githubusercontent.com/Universal-Debloater-Alliance/universal-android-debloater-next-generation/refs/heads/main/resources/assets/uad_lists.json';
    const PACKAGES_PER_PAGE = 100;

    let allEntries = [];
    let filteredEntries = [];
    let currentPage = 1;
    let debounceTimeout;

    const searchInput = document.getElementById('search');
    const listSelect = document.getElementById('filterList');
    const removalSelect = document.getElementById('filterRemoval');
    const resultsContainer = document.getElementById('results');
    const showMoreBtn = document.getElementById('showMoreBtn');

    // --- Event Listeners ---
    searchInput.addEventListener('input', () => {
      clearTimeout(debounceTimeout);
      debounceTimeout = setTimeout(triggerFilter, 300);
    });

    [listSelect, removalSelect].forEach(el => {
      el.addEventListener('change', triggerFilter); // Use 'change' for immediate selection
    });
    
    showMoreBtn.addEventListener('click', () => {
        currentPage++;
        renderResultsPage();
    });

    function triggerFilter() {
      currentPage = 1; // Reset to first page on new filter
      applyFilters();
    }

    // --- Data Fetching and Processing ---
    fetch(DATA_URL)
      .then(res => res.json())
      .then(data => {
        allEntries = Object.entries(data).map(([pkg, info]) => ({ pkg, ...info }))
                                         .sort((a, b) => a.pkg.localeCompare(b.pkg));
        applyFilters();
      })
      .catch(err => {
        resultsContainer.innerHTML = '<p>Error fetching data. Please try again later.</p>';
        console.error('Error fetching data:', err)
      });

    function applyFilters() {
      const q = searchInput.value.trim().toLowerCase();
      const listFilter = listSelect.value;
      const remFilter = removalSelect.value;

      filteredEntries = allEntries.filter(entry => {
        if (q && !entry.pkg.toLowerCase().includes(q)) return false;
        if (listFilter && entry.list.toLowerCase() !== listFilter) return false;
        if (remFilter && entry.removal !== remFilter) return false;
        return true;
      });

      resultsContainer.innerHTML = ''; // Clear previous results
      renderResultsPage();
    }

    function renderResultsPage() {
      const startIndex = (currentPage - 1) * PACKAGES_PER_PAGE;
      const endIndex = startIndex + PACKAGES_PER_PAGE;
      const pageEntries = filteredEntries.slice(startIndex, endIndex);

      if (filteredEntries.length === 0 && currentPage === 1) {
        resultsContainer.innerHTML = '<p>No packages found matching your criteria.</p>';
      }

      pageEntries.forEach(entry => {
        resultsContainer.appendChild(createPackageElement(entry));
      });
      
      showMoreBtn.style.display = (endIndex < filteredEntries.length) ? 'block' : 'none';
    }
    
    function createPackageElement({ pkg, removal, list, dependencies, neededBy, labels, description }) {
      const div = document.createElement('div');
      div.className = 'package';
      
      const textDescription = description || 'No description available.';
      const urlRegex = /(https?:\/\/[^\s()<>]+(?:\([\w\d]+\)|[^.,!?"'\]\s]))/g;
      
      const urls = [...textDescription.matchAll(urlRegex)].map(match => match[0]);
      const cleanDescription = textDescription.replace(urlRegex, '').trim();

      let linksContainerHTML = '';
      if (urls.length > 0) {
        const uniqueUrls = [...new Set(urls)]; // Avoid duplicate links
        linksContainerHTML = `<div class="links-container">
          ${uniqueUrls.map(url => {
            try {
              const hostname = new URL(url).hostname;
              return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="fancy-link">
                        <img src="https://www.google.com/s2/favicons?domain=${hostname}&sz=32" alt="favicon">
                        <span>${hostname}</span>
                      </a>`;
            } catch (e) { return ''; }
          }).join('')}
        </div>`;
      }
      
      div.innerHTML = `
        <div class="package-main">
          <div class="package-header">
            <h2>${pkg}<span class="badge badge--${removal}">${removal}</span></h2>
          </div>
          <div class="info"><strong>List:</strong> ${list}</div>
          ${labels?.length ? `<div class="info"><strong>Labels:</strong> ${labels.join(', ')}</div>` : ''}
          ${dependencies?.length ? `<div class="info"><strong>Dependencies:</strong> ${dependencies.join(', ')}</div>` : ''}
          ${neededBy?.length ? `<div class="info"><strong>Needed by:</strong> ${neededBy.join(', ')}</div>` : ''}
          <div class="info">${cleanDescription.split('\\n').join('<br>')}</div>
          
          ${linksContainerHTML}

          <div class="cmd-block">
            <code>adb shell pm uninstall -k --user 0 ${pkg}</code>
            <button onclick="navigator.clipboard.writeText(this.previousElementSibling.textContent)">Copy</button>
          </div>
          <div class="cmd-block">
            <code>adb shell pm disable-user --user 0 ${pkg}</code>
            <button onclick="navigator.clipboard.writeText(this.previousElementSibling.textContent)">Copy</button>
          </div>
        </div>
        <div class="action-buttons">
          <a href="https://play.google.com/store/apps/details?id=${pkg}" class="action-btn" target="_blank" rel="noopener noreferrer">
            <svg><use href="#icon-playstore"></use></svg>
            <span>Play Store</span>
          </a>
          <a href="https://f-droid.org/packages/${pkg}" class="action-btn" target="_blank" rel="noopener noreferrer">
            <svg><use href="#icon-fdroid"></use></svg>
            <span>F-Droid</span>
          </a>
          <a href="https://reports.exodus-privacy.eu.org/en/reports/search/${pkg}" class="action-btn" target="_blank" rel="noopener noreferrer">
            <svg><use href="#icon-exodus"></use></svg>
            <span>Exodus</span>
          </a>
        </div>
      `;
      return div;
    }
  </script>
</body>
</html>
